<%= form_for([:admin,@gallery]) do |f| %>
  <% if @gallery.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@gallery.errors.count, "error") %> prohibited this gallery from being saved:</h2>

      <ul>
      <% @gallery.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= f.label :name %> </br>
    <%= f.text_field :name, :class => "form-control formwidth" %>
  </div>
  </br>
  <div class="field"> 
    <%= f.label :description %> </br>
    <%= f.text_field :description, :class => "form-control formwidth" %>
  </div>
  </br> 


  <div class="field hidden"> 
    <%=f.select :mobile_app_ids, @mobile_apps.all.collect {|x| [x.name, x.id]}, {}, :multiple => true %>
  </div>

  <div class="field">
    <h3>Current Registrations</h3>
    <table id="current_reg_table" class="table table-striped">
      <tr>
        <th>Name</th>
        <th>Description</th>
        <th>Remove</th>
      </tr>
    <% @gallery.mobile_apps.each do |app| %>
      <tr id="app-<%= app.id%>">
        <td><%= app.name %></td>
        <td><%= app.short_description %></td>
        <td><%= link_to "<i class=\"fa fa-remove\">".html_safe, "javascript:remove_registration(#{app.id});" %></td>
      </tr>
    <% end %>
    </table>
  </div>

  <div class="field">
    <h3>Add New Registrations</h3>
    <table id="all_reg_table" class="table table-striped" cellspacing="0" width="100%">
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
          <th>Remove</th>
        </tr>
      </thead>
      <tbody>
        <% @mobile_apps.all.each do |app| %>
          <tr id="app-add-<%= app.id%>">
            <td><%= app.name %></td>
            <td><%= app.short_description %></td>
            <td class="disabled"><%= link_to "<i class=\"fa fa-plus\">".html_safe, "javascript:add_registration(#{app.id});" %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  </br> 
  <div class="actions">
    <%= f.submit :class => "btn btn-default" %>
  </div>

<% end %>
    
<% content_for :additional_javascript do %>
  <script>
    $(document).ready(function(){
      $('#all_reg_table').DataTable();
    });
    function remove_registration(id){
      $('#app-'+id).remove();
      array_of_registrations = $('#gallery_mobile_app_ids').val();
      index_of_element = array_of_registrations.indexOf(id +"");
      if(array_of_registrations.length == 1){
        array_of_registrations = []
      }else if(index_of_element == array_of_registrations.length-1){
        array_of_registrations = array_of_registrations.slice(0,index_of_element);
      }else if(index_of_element == 0){
        array_of_registrations=array_of_registrations.slice(index_of_element+1,array_of_registrations.length);
      }
      else{
        array_of_registrations = array_of_registrations.slice(0,index_of_element).concat(array_of_registrations.slice(index_of_element+1,array_of_registrations.length));
      }
      $('#gallery_mobile_app_ids').val(array_of_registrations);
    }

    function add_registration(id){
      var elements = $('#app-add-'+id).children("td");
      $('#app-'+id).remove();
      $('#current_reg_table tr:last').after('<tr id="app-'+id+'"><td>'+elements[0].innerHTML+'</td><td>'+elements[1].innerHTML+'</td><td><a href="javascript:remove_registration('+id+');"><i class="fa fa-remove"></i></a></td></tr>');
      array_of_registrations = $('#gallery_mobile_app_ids').val();
      if (array_of_registrations== null){
        array_of_registrations = [];
      }
      array_of_registrations = array_of_registrations.concat([id+""]);
      $('#gallery_mobile_app_ids').val(array_of_registrations);
    }
  </script>
<% end %>